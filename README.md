# Cash Deception

## What is?

<div dir="rtl">
<p style="text-align: justify;">اگه با ارسال درخواست به یه مسیر، اطلاعات حساس کاربر که توسط سی‌دی‌ان کش(cache) شدن رو به دست بیاریم، از آسیب‌پذیری کش‌دیسپشن استفاده کرده‌ایم.</p>
<p style="text-align: justify;">درواقع این آسیب‌پذیری به مهاجم اجازه می‌ده تا با سو استفاده از قابلیت کش(cache)، به محتوایی دسترسی پیدا کنه که نباید توسط سی‌دی‌ان(cache server) کش می‌شد.</p>
<ul>
<li style="text-align: justify;">مواردی وجود داره که به صورت مدیریت شده، اطلاعات حساس کاربر کش(cache) می‌شن. اما توی مرورگر خود کاربر و نه توسط سی‌دی‌ان(cache server).</li>
</ul>
</div>

## Why?

<div dir="rtl">
<p style="text-align: justify;">این آسیب‌پذیری زمانی به وجود می‌آد که بین سرور اصلی(origin server) و سرور کش(cache server)، عدم هناهنگی وجود داشته باشه.</p>
</div>

## How to exploit?

<div dir="rtl">
<p style="text-align: justify;">برای اکسپلویت(exploit) کردن این آسیب‌پذیری، مهاجم با دستکاری URL مسیری که اطلاعات حساس(Dynamic content) رو نشون می‌ده، سرور کش رو فریب می‌ده و باعث می‌شه تا پاسخی که نباید کش کنه رو کش کنه. حالا مهاجم یه لینک داره که هرکسی روی اون کلیک کنه، محتواش کش می‌شه. مهاجم هم با باز کردن همون URL محتوای کش شده رو به دست می‌آره.</p>
</div>

# Cash

## Cash Headers

**1.    Cache-Control**

| **Directive** | **توضیح** |
| --- | --- |
| public | اجازه کش کردن توسط  سرور کش و مرورگر |
| private | اجازه کش فقط برای مرورگر |
| no-store | کلا کش نکن |
| no-cache | کش بشه، ولی قبل از استفاده، با سرور چک کنه |
| max-age=0 | بلافاصله منقضی شه |
| s-maxage | برای سرور کش از مکس‌ایج اولویت بیشتری داره |

**2.    X-Cash**

| **X-Cache** **مقدار** | **توضیح** |
| --- | --- |
| hit | درخواست به سرور اصلی نرفته و از کش اومده |
| miss | کش نداشت. پاسخ از سرور اصلی اومد |
| dynamic | محتوای پاسخ توسط سرور به صورت داینامیک تولید شده؛ معمولاً کش نشده |
| refresh | کش قدیمی شده بود و تایید از سرور هم داشت، اما باید بررسی می‌شد |
| revalidate | کش موجود بود ولی نیاز به تایید از سرور داشت |
| stale | پاسخ کش‌شده استفاده شده، حتی با اینکه منقضی شده بوده |

**3.    Vary**

مشخص می‌کنه کش باید بر اساس چه پارامترهایی پاسخ رو تفکیک کنه.

## Cash Key

<p dir="rtl">سرور کش برای اینکه ببینه برای درخواستی که اومده کش داره یا نه، از مسیر(Path)، کوئری(Query)، متد(Method)، بعضی از هدر(Headers)ها و... یه کلید(Cash Key) می‌سازه. اینجوری اگه کلیدی که می‌سازه تکراری باشه، محتوای کلید ساخته شده قبلی رو نشون می‌ده.</p>
<p dir="rtl"> </p>

| **جزء** | **مثال** | **تأثیر بر کش شدن؟** |
| --- | --- | --- |
| **Host** | example.com | همیشه هست |
| **Path** | /index.html | همیشه هست |
| **Query String** | ?page=1 | معمولاً هست |
| **HTTP Method** | GET, POST | GET معمولا |
| **Headers** | Cookie, User-Agent, Accept-Encoding | Vary بسته به |
| **Cookies** | Cookie: session=xyz | Vary: Cookie |
| **Protocol (HTTP vs HTTPS)** | http:// یا https:// | معمولا |
